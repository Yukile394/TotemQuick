plugins {
    id 'java'
    id 'maven-publish'
    id 'java-gradle-plugin'
    id 'idea'
    id 'eclipse'
    id 'groovy'
    id 'checkstyle'
    id 'codenarc'
    id 'org.jetbrains.kotlin.jvm' version '1.9.0'
    id 'com.diffplug.spotless' version '7.2.1'
    id 'org.gradle.test-retry' version '1.6.2'
    id 'fabric-loom' version '1.2.61'
}

group = 'net.fabricmc'
version = '1.13.local'

repositories {
    maven {
        name = 'Fabric'
        url = 'https://maven.fabricmc.net/'
    }
    mavenCentral()
}

tasks.withType(JavaCompile).configureEach {
    it.options.encoding = "UTF-8"
    it.options.release = 21
}

tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).all {
    kotlinOptions {
        jvmTarget = "21"
    }
}

java {
    sourceCompatibility = JavaVersion.VERSION_21
    targetCompatibility = JavaVersion.VERSION_21
    withSourcesJar()
}

dependencies {
    implementation gradleApi()
    implementation "com.google.code.gson:gson:2.10.1"
    implementation "org.ow2.asm:asm:9.9"
    implementation "org.ow2.asm:asm-commons:9.9"
    implementation "org.ow2.asm:asm-analysis:9.9"
    implementation "org.ow2.asm:asm-tree:9.9"
    implementation "org.ow2.asm:asm-util:9.9"

    // Fabric Loom dependencies
    implementation "net.fabricmc:stitch:0.6.2"
    implementation "net.fabricmc:tiny-remapper:0.12.0"
    implementation "net.fabricmc:class-tweaker:0.1.1"
    implementation "net.fabricmc:mapping-io:0.8.0"
    implementation "net.fabricmc:lorenz-tiny:4.0.2"
    implementation "net.fabricmc:mercury:0.4.3"
    implementation "net.fabricmc:mercurymixin:0.2.2"
    implementation "net.fabricmc:fabric-loom-native:0.2.0"
    implementation "net.fabricmc.unpick:unpick:3.0.0-beta.13"
    implementation "net.fabricmc.unpick:unpick-format-utils:3.0.0-beta.13"

    // Kotlin
    implementation "org.jetbrains.kotlin:kotlin-metadata-jvm:2.0.21"
    compileOnly "org.jetbrains.kotlin:kotlin-gradle-plugin:2.0.21"

    // Testing
    testImplementation gradleTestKit()
}

gradlePlugin {
    plugins {
        fabricLoom {
            id = 'fabric-loom'
            implementationClass = 'net.fabricmc.loom.LoomGradlePlugin'
        }
    }
}

spotless {
    lineEndings = com.diffplug.spotless.LineEnding.UNIX
    java {
        licenseHeaderFile(rootProject.file("HEADER")).yearSeparator("-")
    }
    groovy {
        licenseHeaderFile(rootProject.file("HEADER")).yearSeparator("-")
        greclipse()
    }
    kotlin {
        licenseHeaderFile(rootProject.file("HEADER")).yearSeparator("-")
        ktlint()
    }
}
