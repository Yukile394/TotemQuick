// ==================================================
// TotemQuick Build Script
// Fabric Loom 1.3.10 + Gradle 8.14
// Temiz yapılandırma ve güncel loader
// ==================================================

plugins {
    id 'java'
    id 'maven-publish'
    id 'idea'
    id 'eclipse'
    id 'org.jetbrains.kotlin.jvm' version '2.0.21'
    id 'com.diffplug.spotless' version '7.2.1'
    id 'fabric-loom' version '1.3.10'
}

group = 'net.yukile'
version = '1.0.0'

java {
    sourceCompatibility = JavaVersion.VERSION_21
    targetCompatibility = JavaVersion.VERSION_21
    withSourcesJar()
}

repositories {
    mavenCentral()
    maven { url = 'https://maven.fabricmc.net/' } // Fabric repository
    maven { url = 'https://maven.terraformersmc.com/releases' } // Yarn repo
    maven { url = 'https://repo.spongepowered.org/maven' } // Gerektiğinde ek repo
}

dependencies {
    // Minecraft ve mappings
    minecraft "com.mojang:minecraft:1.20.1"
    mappings "net.fabricmc:yarn:1.20.1+build.1:v2"

    // Fabric Loader güncel sürüm
    modImplementation "net.fabricmc:fabric-loader:0.17.12"

    // Kotlin ve yardımcı kütüphaneler
    implementation "org.jetbrains.kotlin:kotlin-stdlib:2.0.21"
    testImplementation "org.junit.jupiter:junit-jupiter:5.10.0"
    testImplementation "org.spockframework:spock-core:2.3-groovy-3.0"
}

tasks.withType(JavaCompile).configureEach {
    options.encoding = 'UTF-8'
    options.release = 21
}

tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).configureEach {
    kotlinOptions {
        jvmTarget = '21'
    }
}

tasks.test {
    useJUnitPlatform()
    maxHeapSize = '2g'
    testLogging {
        events "passed", "skipped", "failed"
    }
}

// Spotless kod formatlama
spotless {
    java {
        googleJavaFormat('1.16.0')
    }
    kotlin {
        ktlint()
    }
}

// Yayınlama ayarları
publishing {
    publications {
        mavenJava(MavenPublication) {
            from components.java
            groupId = project.group
            artifactId = project.name
            version = project.version
        }
    }
    repositories {
        maven {
            url = System.getenv("MAVEN_URL") ?: ""
            credentials {
                username = System.getenv("MAVEN_USERNAME") ?: ""
                password = System.getenv("MAVEN_PASSWORD") ?: ""
            }
        }
    }
}
